<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Gerador de tabelas" />
  <meta property="og:description" content="Defina os times, clique, imprima, feche a página. Grátis, sem cadastro, sem burocracia." />
  <meta property="og:image" content="/static/logo.png" />
  <meta name="description" content="Defina os times, clique, imprima, feche a página. Grátis, sem cadastro, sem burocracia.">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <link rel="icon" type="image/png" href="/static/logo.png" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/pure-min.css">
  <link rel="stylesheet" href="/static/site.css">
  <title>Gerador de tabelas de campeonato</title>
  <script>
var _gauges = _gauges || [];
(function() {
  var t   = document.createElement('script');
  t.type  = 'text/javascript';
  t.async = true;
  t.id    = 'gauges-tracker';
  t.setAttribute('data-site-id', '582898784b2ffa05f600582c');
  t.setAttribute('data-track-path', 'https://track.gaug.es/track.gif');
  t.src = 'https://d36ee2fcip1434.cloudfront.net/track.js';
  var s = document.getElementsByTagName('script')[0];
  s.parentNode.insertBefore(t, s);
})();
  </script>
</head>
<body onload=brython(1)>

<header>
  <h1>
    <a href="/" style="text-decoration: none; color: inherit">Gerador de tabelas de todos contra todos</a>
  </h1>
</header>

<main>

  <div class="pure-g">
    <div class="pure-u-2-5 form">
  
      <form id="form" action="#" method="get" class="pure-form pure-form-stacked">
        <fieldset>
          <label for="teams">Nomes dos times</label>   
          <textarea id="teams" name="teams" placeholder="Um time em cada linha"></textarea>
  
          <label for="return">
            <input id="return" name="return" type="checkbox"> Turno e returno?
          </label>
  
          <button disabled type="submit" class="pure-button pure-button-primary">Aguarde...</button>
  
        </fieldset>
      </form>
  
    </div>
    <div class="pure-u-3-5 desc">
  
      <p>Digite os nomes dos times, um em cada linha, e aperte o botão azul.</p>
  
      <p>Uma linda e imprimível tabela de todos-contra-todos será gerada, com os jogos balanceadamente distribuídos entre as rodadas.</p>
  
    </div>
  </div>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- big-header -->
<ins class="adsbygoogle"
     style="display:inline-block;width:970px;height:90px"
     data-ad-client="ca-pub-2758632292127860"
     data-ad-slot="7802966782"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

  <div id="explanation">
    <h2>A teoria da geração de tabelas de todos-contra-todos</h2>
    <p>Se você tentou fazer a tabela à mão e se decepcionou com a sua incapacidade, não fique assim, a coisa é realmente mais complicada do que parece. Para se confortar, pense que grandes campeonatos de futebol, como o Campeonato Mineiro de 2006, já tiveram a <a target="_blank" href="http://web.archive.org/web/20141220221439/http://esportes.terra.com.br/noticias/0,,OI799885-EI1846,00-FMF+enfim+divulga+a+tabela+do+Mineiro+de.html">divulgação de suas tabelas atrasadas</a> pela falta de um homem conhecedor da técnica para a distribuição efetiva das rodadas.</p>
    <p>À primeira vista parece simples, o time A joga contra todos os outros, o time B joga contra todos os outros menos o A, o time C contra todos exceto A e B e assim por diante, você chega a uma lista com todos os jogos que <u>devem</u> ser jogados. Mas o difícil mesmo é saber a ordem dos jogos: se todos os times devem jogar em todas as rodadas, contra quem eles devem jogar, para que no final as combinações de jogos não se compliquem e dois times sobrem em uma rodada, já tendo jogado entre eles e esperando outros adversários, já ocupados?</p>
    <p>Em campeonatos de 4 times dá pra fazer, mais ou menos no olhômetro, a tabela direitinho; com 5 já complica, mas com sorte e paciência ainda funciona. De 6 pra cima já beira ao impossível. Precisamos do <a target="_blank" href="http://en.wikipedia.org/wiki/Round-robin_tournament">algoritmo:</a></p>
    <p>A descoberta deste algoritmo data de 1883. Há outras formas de fazer o cálculo, mas o princípio é o mesmo em todas, de modo que provavelmente a geração de todas as tabelas de campeonatos de todos os esportes mundo afora passa pelo seguinte procedimento:</p>
    <pre>
    Rodada 1 (A contra J, B contra I, C contra H etc.)
    A  B  C  D  E
    J  I  H  G  F</pre>
    <p>Ordena-se os times segundo qualquer ordem e divide-se-os em duas linhas (nosso exemplo segue a ordem alfabética). Anota-se aí a primeira rodada, o time da linha de cima conta o time imediatamente abaixo.</p>
    <pre>
    Rodada 2 (A contra I, B contra H, C contra G etc.)
    A  J  B  C  D
    I  H  G  F  E</pre>
    <p>Para a próxima rodada, giram-se os times no sentido horário (ou seja, os de cima vão para a direita, os de baixo para a esquerda, o último de cima vai para o final da linha de baixo e o primeiro da linha de baixo sobe para a linha de cima), mantendo-se um deles fixo (no caso, o A).</p>
    <p>E assim sucessicamente, até que se chega à última rodada:</p>
    <pre>
    Rodada 9 (A contra B, C contra J, E contra I etc.)
    A  C  D  E  F
    B  J  I  H  G</pre>
    <p>Que é exatamente uma posição antes da posição inicial -- ou seja, caso girassem-se os times novamente, teríamos de novo a distribuição inicial dos times, perceba -- e aí completa-se o ciclo, todos jogaram contra todos, um jogo por rodada.</p>
    <p>Para campeonatos com número ímpar de times, um time fica sem jogar a cada rodada. No algoritmo, basta adicionar um time falso à roda, e quem cair contra o time falso não joga.</p>
  </div>

</main>

  <footer>
    © <a href="https://alhur.es/">alhures software</a> 2015
  </footer>

  <script src="//cdn.rawgit.com/brython-dev/brython/e4fa8fa38f7ab297caa042264f0204d69435207e/www/src/brython_dist.js"></script>
  <script type="text/python">
from random import shuffle, choice

def compute_rounds(teams, rematch=False):
    # shuffle teams order
    shuffle(teams)

    # get all the matches (with balanced home/away distribution)
    rounds = []
    nteams = len(teams)

    # if odd number of teams, add a BYE
    remove_bye = False
    if nteams % 2 != 0:
        teams.append('_BYE')
        nteams = len(teams)
        remove_bye = True

    nrounds = nteams-1
    halfteams = int(nteams/2)

    pivot = teams[0]
    homerow = teams[1:(halfteams)]
    awayrow = teams[:(halfteams)-1:-1]

    for rnd in range(nrounds):
        # add all matches in the row
        pivotmatch = (pivot, awayrow[0])
        matches = [pivotmatch]
        for i in range((halfteams)-1):
            match = (homerow[i], awayrow[i+1])
            matches.append(match)

        # rotate rows
        homerow.insert(0, awayrow.pop(0))
        awayrow.append(homerow.pop(-1))

        # invert home/away
        if not rnd % 2:
            matches[0] = (matches[0][1], matches[0][0])

        rounds.append(matches)

    # remove bye
    if remove_bye:
        teams.remove('_BYE')
        for matches in rounds:
            for match in matches:
                if '_BYE' in match:
                    matches.remove(match)
                    break

    shuffle(rounds)

    if rematch:
        return_rounds = []
        for matches in rounds:
            fixtures = []
            for match in matches:
                rematch = (match[1], match[0])
                fixtures.append(rematch)
            return_rounds.append(fixtures)
        rounds += return_rounds

    return rounds

from browser import document, ajax
from browser.html import DIV, H3, A

def handle(e):
    e.preventDefault()
    teams = list(filter(bool, document['teams'].value.strip().splitlines()))
    print(teams)
    rounds = compute_rounds(teams, rematch=document['return'].checked)

    main = document.get(selector='main')[0]
    for child in document.get(selector='main > div'):
        main.remove(child)

    ad = DIV('', Class='ad')
    for s in document.get(selector='main > *'):
        ad <= s

    main <= ad
    main <= DIV(
        A('imprimir sem propaganda', onclick='print()', Class='print pure-button pure-button-primary')
    )

    table = DIV('', Class='pure-g table')
    for i, round in enumerate(rounds):
        round_elem = DIV('', Class='pure-u-1 round')
        round_elem <= H3('Rodada ' + str(i+1))

        for match in round:
            match_elem = DIV('', Class='pure-g game')
            match_elem <= DIV(match[0], Class='pure-u-1-3 home team')
            match_elem <= DIV('-', Class='pure-u-1-3 x')
            match_elem <= DIV(match[1], Class='pure-u-1-3 away team')

            round_elem <= match_elem
        table <= round_elem
    main <= table

button = document.get(selector='form button')[0]
button.html = 'Gerar tabela!'
button.disabled = False

document['form'].bind('submit', handle)
  </script>
</body>
